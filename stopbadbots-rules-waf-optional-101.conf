# WordPress - Optional Hardening Rules
#
# This file contains highly specific hardening rules for WordPress environments.
# These rules are NOT intended for general use, as they may cause issues with
# new site installations or specific plugins. Only enable these rules if you
# understand their impact on your specific setup.
#
# Version: 1.1
# Maintainer: StopBadBots.com
# Last Updated: 2025 Aug 15
#
# --- IMPORTANT NOTE ---
# Review each rule carefully before enabling. The rule blocking 'install.php'
# WILL prevent new WordPress sites from being installed.

# =================================================================
# Ruleset Summary (Updated: 2025 Aug 15)
# =================================================================
# 1. id:2000001 (Block wp-admin/install.php Access)
# 2. id:2000002 (Allow Specific Font for Shortcodes Ultimate)
# 3. id:2000003 (Block Shortcodes Ultimate Vendor Folder)
# =================================================================


# =================================================================
# === WordPress Post-Installation Hardening ===
# =================================================================
# This rule should ONLY be enabled on websites that are already fully installed.
# It prevents re-installation attacks by blocking access to the setup script.

# Last Updated: 2025 Aug 15
# Blocks access to the WordPress installation script on an existing site.
SecRule REQUEST_URI "@rx /wp-admin/install\.php" "id:2000001,phase:2,deny,status:403,log,auditlog,msg:'ModSecurity: Denied access to install.php on an existing site.'"


# =================================================================
# === Plugin-Specific Rules: Shortcodes Ultimate ===
# =================================================================
# The following ruleset is designed ONLY for sites using the 'Shortcodes Ultimate' plugin.
# It hardens the plugin by blocking access to its 'vendor' directory, while
# allowing a required font file to be loaded.

# Last Updated: 2025 Aug 15
# 1. EXCEPTION (WHITELIST)
# This rule must come BEFORE the block rule. It creates an exception
# to allow a legitimate font file to be accessed.
SecRule REQUEST_URI "@beginsWith /wp-content/plugins/shortcodes-ultimate/vendor/fork-awesome/fonts/forkawesome-webfont.woff2" "id:2000002,phase:2,pass,nolog,ctl:ruleRemoveById=2000003,msg:'Whitelist: Allowing specific font for Shortcodes Ultimate.'"

# Last Updated: 2025 Aug 15
# 2. BLOCKING RULE
# Blocks general access to the plugin's 'vendor' directory.
SecRule REQUEST_URI "@rx shortcodes-ultimate/vendor/" "id:2000003,phase:2,deny,status:403,log,auditlog,msg:'ModSecurity: Denied access to the Shortcodes Ultimate vendor folder.'"